import{r as a,v as _,j as e,P as q,S as J,T as j,w as K,x as v}from"./index-Dbp6cY2J.js";import{S as X,C as Y}from"./CustomPagination-CmLdiBRs.js";import{V as Z}from"./Visibility-BbAx8QFw.js";import{E as ee,D as te}from"./Edit-p0oQH28y.js";import{u as se,D as ae,T as m}from"./DataGrid-B0QCrr4f.js";import{S as re,A as oe}from"./Snackbar-Dz79FgWn.js";import{D as ie,a as ne,b as le,c as ce,d as de}from"./DialogTitle-BcKG4VFi.js";import{B as T}from"./Button-BL7aqzdx.js";import{I as y}from"./Menu-BX0TDKzG.js";import{S as he}from"./Switch-DMk434Re.js";import"./IconifyIcon-CVzshvhH.js";import"./TextField-CHFAi5Wa.js";import"./Toolbar-Cy1yNAeb.js";import"./Divider-BnrKH_WB.js";import"./InputAdornment-BYBFXy2L.js";import"./Checkbox-COksgwjS.js";import"./colorManipulator-DQXk7iNs.js";import"./useSlot-DopozSqz.js";const ze=()=>{const u=se(),[$,b]=a.useState([]),[N,S]=a.useState(!1),[C,B]=a.useState(""),w=_(),D=localStorage.getItem("authToken"),[g,U]=a.useState(0),[p,P]=a.useState(5),[F,W]=a.useState(0),[k,M]=a.useState(""),[R,A]=a.useState(!1),[V,G]=a.useState(),[i,I]=a.useState({open:!1,message:"",severity:"success",vertical:"top",horizontal:"right"}),f=()=>{A(!1)},x=async(t=g,s=p,o=k)=>{var r,n,h,z;S(!0);try{const l=await v.post(`http://172.236.30.193:8008/api/user?page=${t+1}&limit=${s}&search=${o}`,{headers:{Authorization:`Bearer ${D}`}}),H=l.data.data.map((c,L)=>({id:L+1+t*s,name:c.name?c.name:"N/A",mongoId:c._id,email:c.email,status:c.status}));b(H),W(l.data.total)}catch(l){console.error("Error fetching users:",l),B(((n=(r=l.response)==null?void 0:r.data)==null?void 0:n.message)||"Failed to fetch users"),d({message:((z=(h=l.response)==null?void 0:h.data)==null?void 0:z.message)||"Failed to fetch users",severity:"error"})}finally{S(!1)}},O=async()=>{var t,s,o;try{const r=localStorage.getItem("authToken"),n=await v.delete(`http://172.236.30.193:8008/api/user/${V}`,{headers:{Authorization:`Bearer ${r}`}});n.status===200&&((t=n.data)==null?void 0:t.message)==="User deleted"?d({message:"User deleted successfully.",severity:"success"}):d({message:"Failed to delete user. Please try again.",severity:"error"})}catch(r){d({message:((o=(s=r.response)==null?void 0:s.data)==null?void 0:o.message)||"An error occurred while deleting the user.",severity:"error"})}finally{f(),x()}},d=({vertical:t="top",horizontal:s="right",message:o,severity:r})=>{I({open:!0,message:o,severity:r,vertical:t,horizontal:s})},E=()=>{I(t=>({...t,open:!1}))};a.useEffect(()=>{x()},[g,p,k]);const Q=[{field:"id",headerName:"ID",width:90},{field:"name",headerName:"Name",flex:1,minWidth:150},{field:"email",headerName:"Email",flex:1.5,minWidth:200},{field:"status",headerName:"Status",flex:1,minWidth:70,renderCell:t=>e.jsx(j,{className:"UserStatus",color:t.value==="active"?"success.main":"error.main",children:t.value==="active"?"Active":"Deactive"})},{field:"action",headerName:"Actions",flex:1,minWidth:220,sortable:!1,filterable:!1,renderCell:t=>{const s=()=>{w(`/users/UserEdit/${t.row.mongoId}`)},o=t.row.status==="active",r=async()=>{try{await v.post(`http://172.236.30.193:8008/api/user/toggle-status/${t.row.mongoId}`,{},{headers:{Authorization:`Bearer ${D}`}}),await x()}catch(h){console.error("Error updating status:",h)}},n=()=>{w(`/users/${t.row.mongoId}`)};return e.jsxs(e.Fragment,{children:[e.jsx(m,{title:"View",children:e.jsx(y,{onClick:n,children:e.jsx(Z,{color:"primary"})})}),e.jsx(m,{title:"Edit",children:e.jsx(y,{onClick:s,children:e.jsx(ee,{sx:{color:"#ffa000"}})})}),e.jsx(m,{title:"Delete",children:e.jsx(y,{onClick:()=>{A(!0),G(t.row.mongoId)},children:e.jsx(te,{sx:{color:"#d32f2f"}})})}),e.jsx(m,{title:o?"Deactivate User":"Activate User",children:e.jsx(he,{checked:o,onChange:r,color:"primary"})})]})}}];return e.jsxs(e.Fragment,{children:[e.jsxs(q,{sx:{p:3},children:[e.jsxs(J,{direction:{md:"row"},rowGap:2,justifyContent:"space-between",alignItems:{md:"center"},children:[e.jsx(j,{variant:"h4",color:"primary.dark",children:"User Management"}),e.jsx(X,{apiRef:u,sx:{maxWidth:300},onChange:t=>{const s=t.target.value;M(s),U(0)}})]}),e.jsxs(K,{sx:{height:420,width:1,my:3},children:[e.jsx(ae,{apiRef:u,rows:$,columns:Q,loading:N,pageSizeOptions:[5,10],paginationMode:"server",paginationModel:{page:g,pageSize:p},onPaginationModelChange:t=>{U(t.page),P(t.pageSize)},rowCount:F}),e.jsx(Y,{apiRef:u})]}),C&&e.jsx(j,{mt:2,color:"error.main",children:C})]}),e.jsx(re,{open:i.open,autoHideDuration:6e3,onClose:E,anchorOrigin:{vertical:i.vertical,horizontal:i.horizontal},children:e.jsx(oe,{onClose:E,severity:i.severity,variant:"filled",sx:{width:"100%"},children:i.message})},i.vertical+i.horizontal),e.jsxs(ie,{open:R,onClose:f,children:[e.jsx(ne,{children:"Confirm User Deletion"}),e.jsx(le,{children:e.jsx(ce,{children:"Are you sure you want to delete this user? This action is permanent and cannot be undone."})}),e.jsxs(de,{children:[e.jsx(T,{onClick:f,children:"Cancel"}),e.jsx(T,{onClick:O,color:"error",variant:"contained",children:"Delete"})]})]})]})};export{ze as default};
